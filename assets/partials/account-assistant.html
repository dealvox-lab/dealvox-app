<div class="card">
  <!-- STEP 1: Initial deploy state (no assistant yet) -->
  <section id="assistantInitial" class="asst-section">
    <h3 style="margin-top:0;">Deploy your assistant</h3>
    <p class="muted" style="font-size:0.85rem;margin-bottom:14px;">
      Set up your AI agent basics. We’ll deploy the model and then you can fine-tune details in the assistant settings.
    </p>

    <form id="assistantDeployForm">
      <div class="grid-2">
        <!-- LEFT COLUMN -->
        <div>
          <div class="field">
            <label for="asstNewName">Agent name</label>
            <input id="asstNewName" class="input" placeholder="Jake">
          </div>

          <div class="field">
            <label for="asstNewType">Agent type</label>
            <select id="asstNewType" class="input">
              <option value="2">The Empathizer</option>
              <option value="1">The Challenger</option>
              <option value="3">The Driver</option>
              <option value="4">The Analyst</option>
              <option value="5">The Storyteller</option>
            </select>
          </div>

          <div class="field">
            <label for="asstNewVoice">Agent voice</label>
            <select id="asstNewVoice" class="input">
              <option value='11labs-Billy'>Billy - male, young</option>
              <option value='11labs-Lily'>Lily - female, young</option>
              <option value='11labs-Marissa'>Marissa - female, young</option>
              <option value='11labs-Bing'>Bing - male, young</option>
              <option value='11labs-Jenny'>Jenny - female, young</option>
              <option value='11labs-Lucas'>Lucas - male, middle-aged</option>
              <option value='11labs-Brian'>Brian - male, young</option>
              <option value='11labs-Kate'>Kate - female, middle-aged</option>
              <option value='11labs-Jason'>Jason - male, young</option>
              <option value='11labs-Ethan'>Ethan - male, young</option>
              <option value='11labs-Paul'>Paul - male, old</option>
              <option value='11labs-John'>John - male, middle-aged</option>
              <option value='11labs-Adrian'>Adrian - male, young</option>
              <option value='11labs-Gilfoy'>Gilfoy - male, middle-aged</option>
              <option value='11labs-Zuri'>Zuri - female, old</option>
              <option value='11labs-Steve'>Steve - male, old</option>
              <option value='11labs-Grace'>Grace - female, middle-aged</option>
              <option value='11labs-Chloe'>Chloe - female, young</option>
              <option value='11labs-Max'>Max - male, middle-aged</option>
              <option value='11labs-Anna'>Anna - female, young</option>
              <option value='11labs-Julia'>Julia - female, middle-aged</option>
              <option value='11labs-victoria'>Victoria - female, young</option>
              <option value='11labs-Susan'>Susan - female, middle-aged</option>
              <option value='11labs-Emily'>Emily - female, middle-aged</option>
              <option value='11labs-Kathrine'>Kathrine - female, middle-aged</option>
              <option value='11labs-Andrew'>Andrew - male, young</option>
              <option value='11labs-Nina'>Nina - female, middle-aged</option>
              <option value='11labs-Myra'>Myra - female, young</option>
              <option value='11labs-Evie'>Evie - female, young</option>
              <option value='11labs-James'>James - male, old</option>
              <option value='11labs-Cimo'>Cimo - female, middle-aged</option>
              <option value='11labs-Ryan'>Ryan - male, young</option>
              <option value='11labs-Mia'>Mia - female, middle-aged</option>
            </select>
          </div>
        </div>

        <!-- RIGHT COLUMN: no Intro anymore -->
        <div>
          <p class="muted" style="font-size:0.85rem;margin: 30px 50px 0;">
            When you click <strong>Deploy agent</strong>, we’ll trigger a backend deployment flow
            for this user and configuration. The deployment will take 3-4 minutes, and you'll be redirected to the assistant fine-tuning section after that.
          </p>
        </div>
      </div>
      <div style="margin-top:18px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
        <button type="submit" class="btn-primary" id="asstDeployBtn">
          Deploy assistant
        </button>

        <!-- Loader + note, hidden by default -->
        <span id="asstDeployLoader"
              style="display:none;align-items:center;gap:8px;">
          <span class="spinner"></span>
          <span id="asstDeployNote"
                class="muted"
                style="font-size:0.85rem;">
            Customizing your model…
          </span>
        </span>
      </div>
    </form>
  </section>

  <!-- STEP 2: Manage existing assistant -->
  <section id="assistantManage" class="asst-section" hidden>
    <form id="assistantForm">
      <div class="grid-2">
        <!-- LEFT COLUMN -->
        <div>
          <div class="field">
            <label for="asstAgentId">Assistant ID</label>
            <input id="asstAgentId" class="input" readonly>
          </div>

          <div class="field">
            <label for="asstAgentName">Assistant name (editable)</label>
            <input id="asstAgentName" class="input">
          </div>

          <div class="field">
            <label for="asstAgentType">Assistant type</label>
            <input id="asstAgentType" class="input" readonly>
          </div>

          <div class="field">
            <label for="asstPhoneNumber">Assistant phone number</label>
            <input id="asstPhoneNumber" class="input" readonly>
            <p id="asstPhoneHint" class="muted" style="font-size:0.8rem;margin-top:4px;" hidden>
              No phone number yet? Buy a number below first.
            </p>
          </div>

          <div class="field">
            <label for="asstAgentVoice">Assistant voice (editable)</label>
            <select id="asstAgentVoice" class="input">
              <option value='11labs-Billy'>Billy - male, young</option>
              <option value='11labs-Lily'>Lily - female, young</option>
              <option value='11labs-Marissa'>Marissa - female, young</option>
              <option value='11labs-Bing'>Bing - male, young</option>
              <option value='11labs-Jenny'>Jenny - female, young</option>
              <option value='11labs-Lucas'>Lucas - male, middle-aged</option>
              <option value='11labs-Brian'>Brian - male, young</option>
              <option value='11labs-Kate'>Kate - female, middle-aged</option>
              <option value='11labs-Jason'>Jason - male, young</option>
              <option value='11labs-Ethan'>Ethan - male, young</option>
              <option value='11labs-Paul'>Paul - male, old</option>
              <option value='11labs-John'>John - male, middle-aged</option>
              <option value='11labs-Adrian'>Adrian - male, young</option>
              <option value='11labs-Gilfoy'>Gilfoy - male, middle-aged</option>
              <option value='11labs-Zuri'>Zuri - female, old</option>
              <option value='11labs-Steve'>Steve - male, old</option>
              <option value='11labs-Grace'>Grace - female, middle-aged</option>
              <option value='11labs-Chloe'>Chloe - female, young</option>
              <option value='11labs-Max'>Max - male, middle-aged</option>
              <option value='11labs-Anna'>Anna - female, young</option>
              <option value='11labs-Julia'>Julia - female, middle-aged</option>
              <option value='11labs-victoria'>Victoria - female, young</option>
              <option value='11labs-Susan'>Susan - female, middle-aged</option>
              <option value='11labs-Emily'>Emily - female, middle-aged</option>
              <option value='11labs-Kathrine'>Kathrine - female, middle-aged</option>
              <option value='11labs-Andrew'>Andrew - male, young</option>
              <option value='11labs-Nina'>Nina - female, middle-aged</option>
              <option value='11labs-Myra'>Myra - female, young</option>
              <option value='11labs-Evie'>Evie - female, young</option>
              <option value='11labs-James'>James - male, old</option>
              <option value='11labs-Cimo'>Cimo - female, middle-aged</option>
              <option value='11labs-Ryan'>Ryan - male, young</option>
              <option value='11labs-Mia'>Mia - female, middle-aged</option>
            </select>
          </div>

          <div class="field">
            <label for="asstKnowledgeFile" style="display:flex;align-items:center;gap:8px;">
              Knowledge base (editable)

              <!-- (?) helper -->
              <a
                href="#"
                id="asstKbHelpBtn"
                class="muted"
                style="font-size:.85rem;text-decoration:none;border:1px solid rgba(32,117,174,.25);background:rgba(32,117,174,.10);padding:2px 7px;border-radius:999px;line-height:1;"
                onclick="return false;"
                aria-label="Knowledge base help"
                title="Knowledge base help"
              >(?)</a>
          </label>
            <div
              id="asstKbSavedName"
              style="margin:6px 0 8px; color:#0B6B2E; font-weight:400; font-size: .85rem; display:none;"
            ></div>

            <input id="asstKnowledgeFile" type="file" class="input">

<!-- ✅ NEW: Knowledge base file templates (inline) -->
<div style="margin-top:10px;">
  <div class="muted" style="font-size:.82rem; margin-bottom:6px;">
    Knowledge base file templates:
  </div>

  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
    <a
      class="btn-kb-doc"
      href="https://app.dealvox.online/docs/logistics_business.txt"
      download="logistics_business.txt"
    >
      logistics_business.txt
    </a>

    <a
      class="btn-kb-doc"
      href="https://app.dealvox.online/docs/pc_repair_business.txt"
      download="pc_repair_business.txt"
    >
      pc_repair_business.txt
    </a>

    <a
      class="btn-kb-doc"
      href="https://app.dealvox.online/docs/property_repair_business.txt"
      download="property_repair_business.txt"
    >
      property_repair_business.txt
    </a>
  </div>
</div>

          </div>

          <div class="field">
            <label for="asstWebhookUrl">
              Webhook URL (editable)
              <span class="muted" style="display:block;font-size:0.8rem;margin-top:2px;">
                To get phone call results to your systems.
              </span>
            </label>
            <input id="asstWebhookUrl" class="input">
          </div>

          <div class="field">
            <label for="asstPublished">Is assistant published</label>
            <input id="asstPublished" class="input" readonly>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div>

          <!-- Intro -->
          <div class="field">
            <label for="asstIntroPrompt">Intro (editable)</label>
            <textarea id="asstIntroPrompt" class="input" rows="8"></textarea>
          </div>

          <div class="field">
            <p>You could use following variables: {{firstName}}, {{lastName}}, {{company}}, {{industry}} in your Intro</p>
            <p>Example: Hi {{firstName}} {{lastName}}, this is Jane from Acme Company. We design tailored solutions for the {{industry}} sector.</p>
            <p>Additionally, since the {{industry}} variable is used in the AI presentation, it’s beneficial to include it in the hook.</p>

            <!-- Desired outcome -->
            <div class="field" style="margin-top:16px;">
              <label for="asstDesiredOutcome">Desired outcome (editable)</label>
              <select id="asstDesiredOutcome" class="input">
                <option value="book_a_meeting">Book a meeting</option>
                <option value="transfer_call">Transfer call</option>
                <option value="send_information">Send information</option>
              </select>
            </div>

            <!-- BOOK A MEETING -->
            <div id="outcomeBookMeeting" style="margin-top:14px;">
              <div class="field">
                <label for="asstCalApiKey">
                  Cal.com API key
                  <span class="muted" style="display:inline;font-size:0.8rem;margin-top:2px;">
                    <a href="https://cal.com/docs/api-reference/v2/introduction#authentication" target="_blank">
                      (?)
                    </a>
                  </span>
                </label>
                <input id="asstCalApiKey" class="input" placeholder="cal_live_xxx">
              </div>

              <div class="field">
                <label for="asstCalEventTypeId">
                  Cal.com Event Type ID
                  <span class="muted" style="display:inline;font-size:0.8rem;margin-top:2px;">
                    <a href="https://cal.com/help/event-types/eventtype-id" target="_blank">
                      (?)
                    </a>
                  </span>
                </label>
                <input id="asstCalEventTypeId" class="input" placeholder="123456">
              </div>

              <div class="field">
                <label>Check time availability before booking</label>
                <div style="display:flex;gap:16px;margin-top:6px;">
                  <label style="display:flex;align-items:center;gap:8px;">
                    <input type="checkbox" id="asstCalCheckAvailabilityYes">
                    Yes
                  </label>
                  <label style="display:flex;align-items:center;gap:8px;">
                    <input type="checkbox" id="asstCalCheckAvailabilityNo">
                    No
                  </label>
                </div>
              </div>
            </div>

            <!-- TRANSFER CALL -->
            <div id="outcomeTransferCall" style="margin-top:14px;" hidden>
              <!-- Phone ALWAYS visible when Transfer call is chosen -->
              <div class="field">
                <label for="asstTransferPhone">Receiving agent phone number</label>
                <input id="asstTransferPhone" class="input" placeholder="+1 555 123 4567">
              </div>

              <div class="field">
                <label>Transfer type</label>
                <div style="display:flex;gap:16px;margin-top:6px;">
                  <label style="display:flex;align-items:center;gap:8px;">
                    <input type="checkbox" id="asstTransferCold"> Cold transfer
                  </label>
                  <label style="display:flex;align-items:center;gap:8px;">
                    <input type="checkbox" id="asstTransferWarm"> Warm transfer
                  </label>
                </div>
              </div>

              <!-- Whisper ONLY if Warm transfer -->
              <div id="outcomeWarmDetails" hidden>
                <div class="field">
                  <label for="asstTransferWhisper">Whisper message</label>
                  <textarea id="asstTransferWhisper" class="input" rows="4"
                    placeholder="Short briefing for the receiving agent."></textarea>
                </div>
              </div>
            </div>

            <!-- SEND INFORMATION -->
            <div id="outcomeSendInfo" style="margin-top:14px;" hidden>
              <div class="field">
                <label>Send via</label>
                <div style="display:flex;gap:16px;margin-top:6px;">
                  <label style="display:flex;align-items:center;gap:8px;">
                    <input type="checkbox" id="asstSendSms"> SMS
                  </label>
                  <label style="display:flex;align-items:center;gap:8px;">
                    <input type="checkbox" id="asstSendSmsEmail"> SMS + email
                  </label>
                </div>
              </div>

              <!-- Message ALWAYS visible when Send information is chosen -->
              <div class="field">
                <label for="asstSendMessage">Message</label>
                <textarea id="asstSendMessage" class="input" rows="4"></textarea>
              </div>

              <!-- Upload + CC ONLY for SMS + email -->
              <div id="outcomeSendSmsEmailDetails" hidden>
                <div class="field">
                  <label for="asstSendDoc">Document upload</label>
                  <input id="asstSendDoc" type="file" class="input">
                </div>

                <div class="field" id="asstCcWrap">
                  <label for="asstCcEmail">CC email address</label>
                  <input id="asstCcEmail" class="input">
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div style="margin-top:18px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
        <button type="submit" class="btn-primary" id="asstSaveBtn">Save and Publish</button>

        <button type="button" class="btn-primary-2" id="asstTestCallBtn" hidden>
          Test call
        </button>

        <button type="button" class="btn-secondary" id="asstDeleteBtn">
          <span style="color:#FF0000;">Delete assistant</span>
        </button>

        <span id="asstStatus" class="muted"></span>
      </div>
    </form>

    <!-- TEST CALL MODAL -->
    <div id="asstTestCallModal" class="modal-overlay" hidden>
      <div class="modal-card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
          <h3 style="margin:0;">Get a test call</h3>
          <button type="button" id="asstTestCallClose" class="btn-secondary">Close</button>
        </div>

        <p class="muted" style="margin-top:8px;">
          We’ll call your number using your assistant’s purchased phone number.
        </p>
        <p class="muted" style="margin-top:10px;">
          From number: <span id="asstTestFromNumber">—</span>
        </p>
        <div class="field" style="margin-top:14px;">
          <label for="asstTestToNumber">Destination phone number</label>
          <input id="asstTestToNumber" class="input" placeholder="+12137774445">
        </div>

        <div class="grid-2" style="margin-top:10px;">
          <div class="field">
            <label for="asstVarFirstName">First name</label>
            <input id="asstVarFirstName" class="input" placeholder="John">
          </div>
          <div class="field">
            <label for="asstVarLastName">Last name</label>
            <input id="asstVarLastName" class="input" placeholder="Doe">
          </div>
          <div class="field">
            <label for="asstVarCompany">Company</label>
            <input id="asstVarCompany" class="input" placeholder="Acme Inc.">
          </div>
          <div class="field">
            <label for="asstVarIndustry">Industry</label>
            <input id="asstVarIndustry" class="input" placeholder="Finance">
          </div>
        </div>

        <div style="margin-top:16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
          <button type="button" class="btn-primary" id="asstCallMeBtn">Call me</button>
          <span id="asstTestCallStatus" class="muted"></span>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- ✅ NEW: minimal button styling (paste once in your CSS) -->
<style>
  .btn-kb-doc{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:7px 10px;
    border-radius:10px;
    background:rgba(32,117,174,.12); /* light-blue */
    border:1px solid rgba(32,117,174,.22);
    color:#0b3a57;
    font-size:.82rem;
    font-weight:600;
    text-decoration:none;
    line-height:1;
    transition: transform .08s ease, background .15s ease;
    white-space:nowrap;
  }
  .btn-kb-doc:hover{
    background:rgba(32,117,174,.18);
    transform: translateY(-1px);
  }
  .btn-kb-doc:active{
    transform: translateY(0);
  }
</style>

<!-- Buy number card -->
<div class="card" id="asstBuyCard" style="margin-top:32px" hidden>
  <h3>Buy a phone number</h3>
  <p class="muted" style="font-size:0.85rem;margin-bottom:14px;">
    Get a dedicated U.S. phone number for outbound calls.
  </p>

  <div class="grid-2">
    <div>
      <div class="field">
        <label for="asstPhoneAreaSelect">Preferred phone number area (US only)</label>
        <select id="asstPhoneAreaSelect" class="input"></select>
      </div>
    </div>
    <div>
      <p class="muted" style="font-size:0.8rem;">
        Choose an area / region. We'll try to match this area code when provisioning your number.
      </p>
    </div>
  </div>

  <div style="margin-top:12px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
    <button type="button" class="btn-secondary" id="asstBuyNumberBtn">
      Buy number
    </button>

    <!-- Processing loader -->
    <span id="asstBuySpinner" style="display:none;align-items:center;gap:8px;">
      <span class="spinner"></span>
      <span id="asstBuySpinnerText" class="muted">Processing…</span>
    </span>

    <span id="asstBuyStatus" class="muted"></span>
  </div>
</div>
<div id="asstKbHelpModal" class="modal-overlay" hidden>
  <div class="modal-card" style="max-width:720px;">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <h3 style="margin:0;">Knowledge base guidelines</h3>
      <button type="button" id="asstKbHelpClose" class="btn-secondary">Close</button>
    </div>

    <p class="muted" style="margin-top:10px;">
      The Knowledge Base document is the main source the bot uses to build its presentation, so it must be clear, structured, and easy to scan.
    </p>

    <p style="margin-top:12px;font-weight:600;">Please include these obligatory blocks:</p>

    <ul style="margin-top:8px;padding-left:18px;line-height:1.55;">
      <li><strong>Business</strong> — business name + short description</li>
      <li><strong>Covered demands</strong> — what gaps/problems the business solves</li>
      <li><strong>Business Offer</strong> — the core offer the bot should present and push forward</li>
      <li><strong>Features and Benefits</strong> — key value points that help the bot handle objections and explain “why this” confidently</li>
    </ul>
  </div>
</div>
