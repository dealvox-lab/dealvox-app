<div class="card" id="apiKeyCard">
  <h2>API Access</h2>
  <p>
    Use your personal API key to call the Dealvox API gateway.
    Keep it secret – anyone with this key can send traffic via your account.
  </p>

  <!-- State: no key yet -->
  <div id="apiKeyEmpty" class="api-empty">
    <p>You don’t have an API key yet.</p>
    <button id="apiKeyGenerateBtn" class="btn-primary">
      Generate API key
    </button>
  </div>

  <!-- State: key exists -->
  <div id="apiKeyDetails" class="api-details hidden">
    <label class="field-label">Your API key</label>

    <div class="api-key-row">
      <code id="apiKeyMasked" class="api-key-masked">dvk_•••xxx</code>

      <button id="apiKeyCopyBtn" class="btn secondary small">
        Copy
      </button>

      <button id="apiKeyRegenerateBtn" class="btn danger small">
        Refresh key
      </button>
    </div>

    <p class="hint">
      We only show the first 3 and last 3 characters for security.</p>
    <p class="hint2" id="apiKeyCopyHint">Use “Copy” to copy the full key to your clipboard. Save now and keep it in a secure place to avoid missing it.
    </p>

    <p class="hint" id="apiKeyLastUpdated"></p>
  </div>

  <p id="apiKeyStatus" class="status-text"></p>
</div>

<!-- New: how to trigger a phone call via webhook -->
<section class="api-howto">
  <h3>Start a call via webhook</h3>
  <p>
    Use this endpoint from your CRM, n8n, Make, or any backend to start an outbound call with your
    deployed assistant.
  </p>

  <div class="api-howto-block">
    <!-- Endpoint -->
    <div class="api-howto-item">
      <div class="api-howto-label-row">
        <span class="field-label">Endpoint</span>
        <button
          type="button"
          id="apiWebhookEndpointCopy"
          class="copy-btn"
          aria-label="Copy endpoint URL"
        >
          ⧉
        </button>
      </div>
      <pre id="apiWebhookEndpoint" class="code-block">
https://dealvox-api.ongo-promotion.workers.dev/v2/create-phone-call</pre>
    </div>

    <!-- JSON payload -->
    <div class="api-howto-item">
      <div class="api-howto-label-row">
        <span class="field-label">JSON payload</span>
        <button
          type="button"
          id="apiWebhookBodyCopy"
          class="copy-btn"
          aria-label="Copy JSON payload"
        >
          ⧉
        </button>
      </div>
      <!-- Will be filled / updated by JS so from_number matches assistant phone -->
      <pre id="apiWebhookBody" class="code-block"></pre>

      <!-- Shown only if we don't find a phone_number for the assistant -->
      <p class="hint small danger" id="apiFromNumberHint" style="display:none;">
        Buy a number first for your assistant (Assistant tab) – we’ll auto-fill
        <code>from_number</code> once it’s available.
      </p>
    </div>

    <p class="hint small">
      When calling this endpoint, send your personal API key in the
      <code>X-Api-Key</code> header. <strong>Insert a saved API key</strong> from the
      section above.
    </p>

    <p class="hint small" id="apiWebhookStatus"></p>
  </div>
</section>

