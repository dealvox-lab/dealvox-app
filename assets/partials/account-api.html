<div class="card" id="apiKeyCard">
  <h2>API Access</h2>
  <p>
    Use your personal API key to call the Dealvox API gateway.
    Keep it secret – anyone with this key can send traffic via your account.
  </p>

  <!-- State: no key yet -->
  <div id="apiKeyEmpty" class="api-empty">
    <p>You don’t have an API key yet.</p>
    <button id="apiKeyGenerateBtn" class="btn-primary">
      Generate API key
    </button>
  </div>

  <!-- State: key exists -->
  <div id="apiKeyDetails" class="api-details hidden">
    <label class="field-label">Your API key</label>

    <div class="api-key-row">
      <code id="apiKeyMasked" class="api-key-masked">dvk_•••xxx</code>

      <button id="apiKeyCopyBtn" class="btn secondary small">
        Copy
      </button>

      <button id="apiKeyRegenerateBtn" class="btn danger small">
        Refresh key
      </button>
    </div>

    <p class="hint">
      We only show the first 3 and last 3 characters for security.</p>
    <p class="hint2" id="apiKeyCopyHint">Use “Copy” to copy the full key to your clipboard. Save now and keep it in a secure place to avoid missing it.
    </p>

    <p class="hint" id="apiKeyLastUpdated"></p>
  </div>

  <p id="apiKeyStatus" class="status-text"></p>
</div>

<!-- New: how to trigger a phone call via webhook -->
<div class="card">
  <section class="api-howto">
  <h3>Start a call via webhook</h3>
  <p>
    Use this endpoint from your CRM, n8n, Make, or any backend to start an outbound call with your
    deployed assistant.
  </p>

  <div class="api-howto-block">
    <!-- Endpoint -->
    <div class="api-howto-item">
      <div class="api-howto-label-row">
        <span class="field-label">Endpoint</span>
        <button
          type="button"
          id="apiWebhookEndpointCopy"
          class="copy-btn"
          aria-label="Copy endpoint URL"
        >
          ⧉
        </button>
      </div>
      <pre id="apiWebhookEndpoint" class="code-block">
https://dealvox-api.ongo-promotion.workers.dev/v2/create-phone-call</pre>
    </div>

    <!-- JSON payload -->
    <div class="api-howto-item">
      <div class="api-howto-label-row">
        <span class="field-label">JSON payload</span>
        <button
          type="button"
          id="apiWebhookBodyCopy"
          class="copy-btn"
          aria-label="Copy JSON payload"
        >
          ⧉
        </button>
      </div>
      <!-- -----------------------------------------
     CALL WEBHOOK EXAMPLE
------------------------------------------ -->
<div class="card" id="apiCallExample" style="margin-top: 32px;">
  <h2>How to Trigger a Phone Call via API</h2>
  <p>
    Use your API key to send a webhook request that tells your Retell agent to start a call immediately.
  </p>

  <!-- Endpoint -->
  <label class="field-label">POST Endpoint</label>
  <div class="code-row">
    <code id="apiWebhookEndpoint">https://dealvox-api.YOUR_WORKER_DOMAIN.dev/v2/create-phone-call</code>
    <button id="apiWebhookEndpointCopy" class="btn secondary small">Copy</button>
  </div>
  <p id="apiWebhookStatus" class="hint"></p>

  <!-- HEADERS -->
  <h3 style="margin-top: 26px;">Headers</h3>

  <div class="code-row">
    <code id="apiHeadersExample">
{
  "Content-Type": "application/json",
  "X-Api-Key": "INSERT_YOUR_API_KEY_HERE"
}
    </code>
    <button id="apiHeadersCopy" class="btn secondary small">Copy</button>
  </div>
  <p id="apiApiKeyHint" class="hint" style="display:none; color: #b91c1c;">
    Insert a saved API key first.
  </p>

  <!-- BODY -->
  <h3 style="margin-top: 26px;">Example JSON Payload</h3>

  <div class="code-row">
    <pre id="apiWebhookBody" class="code-block" style="white-space: pre-wrap;"></pre>
    <button id="apiWebhookBodyCopy" class="btn secondary small">Copy</button>
  </div>

  <p id="apiFromNumberHint" class="hint" style="display:none; color:#b91c1c;">
    Your assistant has no phone number yet. Buy a number first.
  </p>

</div>

      <!-- Will be filled / updated by JS so from_number matches assistant phone -->
      <pre id="apiWebhookBody" class="code-block"></pre>

      <!-- Shown only if we don't find a phone_number for the assistant -->
      <p class="hint small danger" id="apiFromNumberHint" style="display:none;">
        Buy a number first for your assistant (Assistant tab) – we’ll auto-fill
        <code>from_number</code> once it’s available.
      </p>
    </div>

    <p class="hint small">
      When calling this endpoint, send your personal API key in the
      <code>X-Api-Key</code> header. <strong>Insert a saved API key</strong> from the
      section above.
    </p>

    <p class="hint small" id="apiWebhookStatus"></p>
  </div>
</section>
</div>
